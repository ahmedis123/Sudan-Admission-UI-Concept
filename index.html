<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ù…ÙˆØ°Ø¬ Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ù‚Ø¨ÙˆÙ„ Ù„Ù„Ø¬Ø§Ù…Ø¹Ø§Øª Ø§Ù„Ø³ÙˆØ¯Ø§Ù†ÙŠØ© 2025</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary-blue: #2563eb; --accent-blue: #1d4ed8; --background: #f8fafc;
            --success: #16a34a; --success-bg: #f0fdf4; --success-border: #bbf7d0;
            --warning: #f59e0b; --warning-bg: #fffbeb; --warning-border: #fde68a;
            --danger: #ef4444; --danger-bg: #fef2f2; --danger-border: #fecaca;
            --text-primary: #1e293b; --text-secondary: #64748b; --border-color: #e2e8f0; --card-bg: #ffffff;
            --font-family: 'Cairo', sans-serif;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: var(--font-family); background-color: var(--background); color: var(--text-primary); display: flex; justify-content: center; align-items: flex-start; min-height: 100vh; padding: 1rem; }
        .mobile-container { width: 100%; max-width: 420px; background-color: var(--card-bg); border-radius: 1.5rem; box-shadow: 0 10px 25px rgba(0, 0, 0, 0.05); overflow: hidden; display: flex; flex-direction: column; }
        .screen { padding: 1.5rem; display: none; flex-direction: column; gap: 1.5rem; animation: fadeIn 0.5s ease-in-out; }
        .screen.active { display: flex; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .header { text-align: center; padding: 1.5rem 1.5rem 0; border-bottom: 1px solid var(--border-color); }
        .header h1 { font-size: 1.25rem; font-weight: 700; }
        .header p { font-size: 0.9rem; color: var(--text-secondary); margin-top: 0.25rem; }
        .footer { text-align: center; padding: 1rem; font-size: 0.8rem; color: var(--text-secondary); background-color: #f1f5f9; }
        .btn { position: relative; display: flex; justify-content: center; align-items: center; width: 100%; padding: 0.85rem 1rem; border-radius: 0.75rem; border: none; font-family: var(--font-family); font-size: 1rem; font-weight: 600; cursor: pointer; transition: all 0.2s; text-align: center; text-decoration: none; }
        .btn:active { transform: scale(0.98); }
        .btn:disabled { background-color: #94a3b8; cursor: not-allowed; }
        .btn-primary { background-color: var(--primary-blue); color: white; }
        .btn-primary:hover:not(:disabled) { background-color: var(--accent-blue); }
        .btn-secondary { background-color: var(--card-bg); color: var(--primary-blue); border: 1px solid var(--primary-blue); }
        .btn-secondary:hover { background-color: #eff6ff; }
        .btn-success { background-color: var(--success); color: white; }
        .card { background-color: var(--card-bg); border-radius: 1rem; padding: 1.5rem; border: 1px solid var(--border-color); box-shadow: 0 4px 10px rgba(0, 0, 0, 0.03); }
        .form-group { display: flex; flex-direction: column; gap: 0.5rem; }
        .form-group label { font-size: 0.9rem; font-weight: 600; }
        .form-group input, .form-group select { width: 100%; padding: 0.75rem; border-radius: 0.5rem; border: 1px solid var(--border-color); font-family: var(--font-family); font-size: 1rem; background-color: #f8fafc; }
        .form-group input:focus, .form-group select:focus { outline: none; border-color: var(--primary-blue); box-shadow: 0 0 0 2px #dbeafe; }
        .form-group .validation-message { font-size: 0.8rem; color: var(--danger); display: none; margin-top: 0.25rem; }
        .form-group.invalid input { border-color: var(--danger); }
        .form-group.invalid .validation-message { display: block; }
        .info-box { padding: 1rem; border-radius: 0.75rem; background-color: #eff6ff; color: #1e3a8a; font-size: 0.85rem; border: 1px solid #bfdbfe; line-height: 1.6; }
        .success-banner { text-align: center; padding: 1.5rem; border-radius: 1rem; background-color: var(--success-bg); color: #15803d; border: 1px solid var(--success-border); }
        .success-banner .icon { font-size: 3rem; line-height: 1; }
        .success-banner h2 { font-size: 1.5rem; margin-top: 0.5rem; }
        .progress-bar { display: flex; justify-content: space-between; align-items: center; padding: 0 1.5rem; margin-bottom: 1rem; position: relative; }
        .progress-bar::before { content: ''; position: absolute; top: 50%; right: 0; width: 100%; height: 2px; background-color: var(--border-color); z-index: 1; }
        .progress-line { position: absolute; top: 50%; right: 0; height: 2px; background-color: var(--primary-blue); z-index: 2; width: 0%; transition: width 0.4s ease; }
        .step { width: 30px; height: 30px; border-radius: 50%; background-color: var(--card-bg); border: 2px solid var(--border-color); display: flex; justify-content: center; align-items: center; font-weight: 700; color: var(--text-secondary); z-index: 3; transition: all 0.4s ease; }
        .step.active { border-color: var(--primary-blue); background-color: var(--primary-blue); color: white; }
        .countdown-banner { background-color: var(--warning-bg); color: #b45309; padding: 0.75rem 1rem; border-radius: 0.75rem; text-align: center; font-weight: 600; font-size: 0.9rem; }
        .disclaimer { font-size: 0.8rem; text-align: center; color: var(--text-secondary); padding: 0.5rem 1rem; background-color: #f1f5f9; border-radius: 0.5rem; }
        .link { color: var(--primary-blue); text-decoration: none; font-weight: 600; font-size: 0.9rem; text-align: center; }
        .tooltip { font-size: 0.8rem; color: var(--text-secondary); text-align: center; margin-top: -1rem; }
        .invoice-display { display: flex; align-items: center; gap: 1rem; background-color: #f1f5f9; padding: 1rem; border-radius: 0.75rem; border: 1px dashed var(--border-color); }
        .invoice-display span { font-size: 1.25rem; font-weight: 700; letter-spacing: 2px; flex-grow: 1; text-align: center; }
        .invoice-display button { padding: 0.5rem 0.75rem; font-size: 0.8rem; border-radius: 0.5rem; }
        .toast { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background-color: var(--text-primary); color: white; padding: 0.75rem 1.5rem; border-radius: 2rem; font-size: 0.9rem; z-index: 100; opacity: 0; visibility: hidden; transition: all 0.3s; }
        .toast.show { opacity: 1; visibility: visible; transform: translate(-50%, -10px); }
        .preference-item { display: flex; align-items: center; gap: 0.5rem; padding: 0.75rem 1rem; border: 1px solid var(--border-color); border-radius: 0.75rem; background-color: var(--card-bg); transition: background-color 0.2s; }
        .preference-item.dragging { opacity: 0.5; background-color: #e0e7ff; }
        .drag-handle { cursor: grab; color: var(--text-secondary); padding: 0 0.5rem; font-size: 1.5rem; line-height: 1; user-select: none; }
        .preference-item .num { font-weight: 700; color: var(--primary-blue); width: 2ch; text-align: center; }
        .preference-item .text { flex-grow: 1; font-size: 0.9rem; }
        .preference-item .delete-btn { background: none; border: none; color: #ef4444; cursor: pointer; font-size: 1.2rem; }
        .review-summary dt { font-weight: 600; color: var(--text-secondary); font-size: 0.9rem; }
        .review-summary dd { font-weight: 400; margin-bottom: 1rem; font-size: 1rem; }
        .review-summary dd ol { padding-right: 1.5rem; }
        .checkbox-group { display: flex; align-items: center; gap: 0.75rem; background-color: #f1f5f9; padding: 1rem; border-radius: 0.75rem; }
        .checkbox-group input { width: 1.25rem; height: 1.25rem; accent-color: var(--primary-blue); }
        .checkbox-group label { font-size: 0.85rem; line-height: 1.5; }
        .status-card { text-align: center; padding: 2rem 1.5rem; border-radius: 1rem; border: 1px solid; }
        .status-card .icon { font-size: 3rem; line-height: 1; margin-bottom: 1rem; }
        .status-card h2 { font-size: 1.5rem; margin-bottom: 0.5rem; }
        .status-card p { font-size: 1rem; margin-bottom: 1.5rem; }
        .status-card-accepted { background-color: var(--success-bg); color: #14532d; border-color: var(--success-border); }
        .status-card-processing { background-color: var(--warning-bg); color: #78350f; border-color: var(--warning-border); }
        .status-card-rejected { background-color: var(--danger-bg); color: #991b1b; border-color: var(--danger-border); }
        .acceptance-details { text-align: right; font-size: 1rem; }
        .acceptance-details strong { color: var(--text-primary); }
        .spinner { width: 20px; height: 20px; border: 2px solid rgba(255, 255, 255, 0.3); border-radius: 50%; border-top-color: white; animation: spin 1s ease-in-out infinite; }
        .btn.loading .btn-text { visibility: hidden; }
        .btn.loading .spinner { position: absolute; }
        @media print { body { padding: 0; background-color: white; } .mobile-container { max-width: 100%; box-shadow: none; border-radius: 0; } .screen, .header, .footer, .btn, .disclaimer, .countdown-banner { display: none !important; } #success-screen, #status-screen .status-card-accepted { display: flex !important; } .btn { display: none !important; } }
    </style>
</head>
<body>
    <div class="mobile-container">
        <header class="header">
            <h1>Ù†Ù…ÙˆØ°Ø¬ Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ù…ÙˆØ­Ø¯</h1>
            <p>Ø¬Ù…Ù‡ÙˆØ±ÙŠØ© Ø§Ù„Ø³ÙˆØ¯Ø§Ù† - 2025</p>
        </header>

        <div id="progress-container" style="display: none;">
            <div class="progress-bar"><div class="progress-line" id="progress-line"></div><div class="step active" data-step="1">1</div><div class="step" data-step="2">2</div><div class="step" data-step="3">3</div><div class="step" data-step="4">4</div><div class="step" data-step="5">5</div></div>
        </div>

        <main id="home-screen" class="screen active">
            <h2>Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</h2>
            <p class="disclaimer">âš ï¸ <strong>Ø¥Ø®Ù„Ø§Ø¡ Ù…Ø³Ø¤ÙˆÙ„ÙŠØ©:</strong> Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù‡Ùˆ Ù†Ù…ÙˆØ°Ø¬ Ù„Ø£ØºØ±Ø§Ø¶ ØªØ¹Ù„ÙŠÙ…ÙŠØ© ÙˆØªÙˆØ¶ÙŠØ­ÙŠØ© ÙÙ‚Ø·ØŒ ÙˆÙ„Ø§ ÙŠÙ…Ø«Ù„ Ø§Ù„Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø±Ø³Ù…ÙŠØ© Ù„Ù„Ù‚Ø¨ÙˆÙ„. Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆÙ‡Ù…ÙŠØ© ÙˆØºÙŠØ± Ø­Ù‚ÙŠÙ‚ÙŠØ©.</p>
            <div class="countdown-banner">ÙŠÙ†ØªÙ‡ÙŠ Ø§Ù„ØªÙ‚Ø¯ÙŠÙ… ÙŠÙˆÙ… 14 Ù†ÙˆÙÙ…Ø¨Ø± 2025 (Ø¨Ø§Ù‚ÙŠ 6 Ø£ÙŠØ§Ù…)</div>
            <div style="display: flex; flex-direction: column; gap: 1rem; width: 100%;"><button class="btn btn-primary" data-target="invoice-screen" data-flow="new"><span class="btn-text">ğŸš€ Ø§Ø¨Ø¯Ø£ ØªÙ‚Ø¯ÙŠÙ… Ø¬Ø¯ÙŠØ¯</span></button><a href="https://daleel.admission.gov.sd/" target="_blank" class="btn btn-secondary">ğŸ“– Ø¯Ù„ÙŠÙ„ Ø§Ù„Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ø±Ø³Ù…ÙŠ</a><button class="btn btn-secondary" data-target="login-screen" data-flow="resume"><span class="btn-text">ğŸ”„ Ù…ØªØ§Ø¨Ø¹Ø© Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨</span></button></div>
        </main>

        <main id="invoice-screen" class="screen">
            <h3>Ø§Ù„Ø®Ø·ÙˆØ© 1: Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©</h3>
            <form id="invoice-form" onsubmit="return false;">
                <div class="form-group">
                    <label for="seat-number">Ø±Ù‚Ù… Ø§Ù„Ø¬Ù„ÙˆØ³ (7 Ø£Ø±Ù‚Ø§Ù…)</label>
                    <input type="number" id="seat-number" placeholder="Ù…Ø«Ø§Ù„: 1234567" aria-required="true" aria-label="Ø±Ù‚Ù… Ø§Ù„Ø¬Ù„ÙˆØ³ Ø§Ù„Ù…ÙƒÙˆÙ† Ù…Ù† Ø³Ø¨Ø¹Ø© Ø£Ø±Ù‚Ø§Ù…">
                    <div class="validation-message">Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø¬Ù„ÙˆØ³ ØµØ­ÙŠØ­ Ù…ÙƒÙˆÙ† Ù…Ù† 7 Ø£Ø±Ù‚Ø§Ù….</div>
                </div>
                <div class="form-group"><label for="course-type">Ù†ÙˆØ¹ Ø§Ù„Ù…Ø³Ø§Ù‚</label><select id="course-type" aria-label="Ù†ÙˆØ¹ Ø§Ù„Ù…Ø³Ø§Ù‚"><option value="science">Ø¹Ù„Ù…ÙŠ</option><option value="arts">Ø£Ø¯Ø¨ÙŠ</option></select></div>
                <div class="form-group"><label for="exam-year">Ø³Ù†Ø© Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†</label><select id="exam-year" aria-label="Ø³Ù†Ø© Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†"><option value="2025">2025</option><option value="2024">2024</option></select></div>
                <div class="form-group"><label for="admission-type">Ù†ÙˆØ¹ Ø§Ù„Ù‚Ø¨ÙˆÙ„</label><select id="admission-type" aria-label="Ù†ÙˆØ¹ Ø§Ù„Ù‚Ø¨ÙˆÙ„"><option value="general">Ø¹Ø§Ù…</option><option value="private">Ø®Ø§Øµ</option><option value="workers">Ø£Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø¹Ø§Ù…Ù„ÙŠÙ†</option><option value="foreign">Ø´Ù‡Ø§Ø¯Ø§Øª Ø¹Ø±Ø¨ÙŠØ©/Ø£Ø¬Ù†Ø¨ÙŠØ©</option></select></div>
            </form>
            <div class="info-box">Ø³ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù‡Ø°Ø§ Ø§Ù„Ø±Ù‚Ù… ÙÙŠ ØªØ·Ø¨ÙŠÙ‚ <strong>Ø¨Ù†ÙƒÙƒ</strong> Ø£Ùˆ <strong>ÙÙˆØ±ÙŠ</strong> Ù„Ø¯ÙØ¹ Ø±Ø³ÙˆÙ… Ø§Ù„ØªÙ‚Ø¯ÙŠÙ….</div>
            <button id="generate-invoice-btn" class="btn btn-primary"><span class="btn-text">Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©</span></button>
            <div id="invoice-result" style="display: none; width: 100%; gap: 1rem; flex-direction: column;"><p style="text-align: center; font-weight: 600;">ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø±Ù‚Ù… Ø§Ù„Ø¯ÙØ¹ Ø¨Ù†Ø¬Ø§Ø­.</p><div class="invoice-display"><span id="invoice-number-text"></span><button id="copy-invoice-btn" class="btn btn-secondary"><span class="btn-text">Ù†Ø³Ø®</span></button></div><button class="btn btn-primary" data-target="login-screen"><span class="btn-text">ØªÙ… Ø§Ù„Ø¯ÙØ¹ØŒ Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„Ø®Ø·ÙˆØ© Ø§Ù„ØªØ§Ù„ÙŠØ©</span></button></div>
        </main>

        <main id="login-screen" class="screen">
            <h3>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h3>
            <form id="login-form" onsubmit="return false;">
                <div class="form-group"><label for="login-seat-number">Ø±Ù‚Ù… Ø§Ù„Ø¬Ù„ÙˆØ³</label><input type="number" id="login-seat-number" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø¬Ù„ÙˆØ³Ùƒ" aria-required="true"><div class="validation-message">Ø±Ù‚Ù… Ø§Ù„Ø¬Ù„ÙˆØ³ Ù…Ø·Ù„ÙˆØ¨.</div></div>
                <div class="form-group"><label for="form-number">Ø±Ù‚Ù… Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø±Ø©</label><input type="number" id="form-number" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø±Ø©" aria-required="true"><div class="validation-message">Ø±Ù‚Ù… Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø±Ø© Ù…Ø·Ù„ÙˆØ¨.</div></div>
            </form>
            <div class="tooltip">â„¹ï¸ Ø±Ù‚Ù… Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø±Ø© ÙŠÙÙ…Ù†Ø­ Ø¨Ø¹Ø¯ Ø¯ÙØ¹ Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø¨Ù†Ø¬Ø§Ø­.</div><button id="login-btn" class="btn btn-primary"><span class="btn-text">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</span></button><a href="#" class="link">Ù†Ø³ÙŠØª Ø±Ù‚Ù… Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø±Ø©ØŸ</a>
        </main>

        <main id="preferences-screen" class="screen">
            <h3>Ø§Ù„Ø®Ø·ÙˆØ© 3: Ø§Ø®ØªÙŠØ§Ø± ÙˆØªØ±ØªÙŠØ¨ Ø§Ù„Ø±ØºØ¨Ø§Øª</h3>
            <div class="info-box">ğŸ’¡ Ø§Ø³Ø­Ø¨ ÙˆØ£ÙÙ„Øª Ø§Ù„Ø±ØºØ¨Ø§Øª Ù„ØªØ±ØªÙŠØ¨Ù‡Ø§ Ø­Ø³Ø¨ Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©.</div>
            <div id="preferences-list" style="display: flex; flex-direction: column; gap: 1rem; width: 100%;"></div>
            <div class="card" id="add-preference-card"><div class="form-group"><label for="university">Ø§Ù„Ø¬Ø§Ù…Ø¹Ø©</label><select id="university"><option>Ø§Ø®ØªØ± Ø§Ù„Ø¬Ø§Ù…Ø¹Ø©...</option><option>Ø¬Ø§Ù…Ø¹Ø© Ø§Ù„Ø®Ø±Ø·ÙˆÙ…</option><option>Ø¬Ø§Ù…Ø¹Ø© Ø§Ù„Ø³ÙˆØ¯Ø§Ù† Ù„Ù„Ø¹Ù„ÙˆÙ… ÙˆØ§Ù„ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§</option><option>Ø¬Ø§Ù…Ø¹Ø© Ø§Ù„Ù†ÙŠÙ„ÙŠÙ†</option></select></div><div class="form-group"><label for="faculty">Ø§Ù„ÙƒÙ„ÙŠØ©</label><select id="faculty"><option>Ø§Ø®ØªØ± Ø§Ù„ÙƒÙ„ÙŠØ©...</option><option>ÙƒÙ„ÙŠØ© Ø§Ù„Ù‡Ù†Ø¯Ø³Ø©</option><option>ÙƒÙ„ÙŠØ© Ø§Ù„Ø·Ø¨</option><option>ÙƒÙ„ÙŠØ© Ø¹Ù„ÙˆÙ… Ø§Ù„Ø­Ø§Ø³ÙˆØ¨</option><option>ÙƒÙ„ÙŠØ© Ø§Ù„Ø§Ù‚ØªØµØ§Ø¯</option></select></div></div>
            <button id="add-preference-btn" class="btn btn-secondary"><span class="btn-text">+ Ø¥Ø¶Ø§ÙØ© Ø±ØºØ¨Ø© Ø¬Ø¯ÙŠØ¯Ø©</span></button>
            <button class="btn btn-primary" data-target="review-screen"><span class="btn-text">Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø±ØºØ¨Ø§Øª</span></button>
        </main>

        <main id="review-screen" class="screen">
            <h3>Ø§Ù„Ø®Ø·ÙˆØ© 4: Ù…Ø±Ø§Ø¬Ø¹Ø© ÙˆØªØ£ÙƒÙŠØ¯ Ø§Ù„ØªÙ‚Ø¯ÙŠÙ…</h3>
            <div class="card"><dl class="review-summary"><dt>Ø±Ù‚Ù… Ø§Ù„Ø¬Ù„ÙˆØ³</dt><dd id="review-seat-number"></dd><dt>Ù†ÙˆØ¹ Ø§Ù„Ù‚Ø¨ÙˆÙ„</dt><dd id="review-admission-type"></dd><dt>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±ØºØ¨Ø§Øª (Ø¨Ø§Ù„ØªØ±ØªÙŠØ¨)</dt><dd><ol id="review-preferences-list"></ol></dd></dl></div>
            <div class="checkbox-group"><input type="checkbox" id="confirmation-check"><label for="confirmation-check">Ø£Ù‚Ø± Ø¨Ø£Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØµØ­ÙŠØ­Ø© ÙˆÙ…Ø·Ø§Ø¨Ù‚Ø© Ù„Ù„Ø´Ù‡Ø§Ø¯Ø© Ø§Ù„Ø«Ø§Ù†ÙˆÙŠØ©.</label></div>
            <div style="display: flex; gap: 1rem; width: 100%;"><button class="btn btn-secondary" data-target="preferences-screen" style="flex: 1;"><span class="btn-text">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø±ØºØ¨Ø§Øª</span></button><button id="confirm-submission-btn" class="btn btn-primary" data-target="success-screen" style="flex: 2;" disabled><span class="btn-text">ØªØ£ÙƒÙŠØ¯ Ø§Ù„ØªÙ‚Ø¯ÙŠÙ…</span></button></div>
        </main>

        <main id="success-screen" class="screen">
            <div class="success-banner"><div class="icon">ğŸ‰</div><h2>ØªÙ… ØªÙ‚Ø¯ÙŠÙ…Ùƒ Ø¨Ù†Ø¬Ø§Ø­!</h2></div>
            <div class="card" style="text-align: center;"><p><strong>âš ï¸ ØªÙ†Ø¨ÙŠÙ‡ Ù‡Ø§Ù…:</strong> Ø§Ø­ØªÙØ¸ Ø¨Ø±Ù‚Ù… Ø§Ø³ØªÙ…Ø§Ø±ØªÙƒ ÙÙŠ Ù…ÙƒØ§Ù† Ø¢Ù…Ù†ØŒ Ø³ØªØ­ØªØ§Ø¬Ù‡ Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø­Ø§Ù„Ø© Ø·Ù„Ø¨Ùƒ Ù„Ø§Ø­Ù‚Ø§Ù‹.</p><div class="invoice-display" style="margin-top: 1rem;"><span id="final-form-number"></span></div></div>
            <div style="display: flex; flex-direction: column; gap: 1rem; width: 100%;"><button id="print-form-btn" class="btn btn-success"><span class="btn-text">ğŸ“„ Ø·Ø¨Ø§Ø¹Ø©/Ø­ÙØ¸ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø±Ø©</span></button><button class="btn btn-secondary" data-target="home-screen"><span class="btn-text">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span></button></div>
        </main>
        
        <main id="status-screen" class="screen">
            <h3>Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨</h3><div id="status-card-container"></div><button class="btn btn-secondary" data-target="home-screen"><span class="btn-text">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span></button>
        </main>

        <footer class="footer">Â© 2025 ÙˆØ²Ø§Ø±Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ… Ø§Ù„Ø¹Ø§Ù„ÙŠ ÙˆØ§Ù„Ø¨Ø­Ø« Ø§Ù„Ø¹Ù„Ù…ÙŠ â€“ Ø¬Ù…Ù‡ÙˆØ±ÙŠØ© Ø§Ù„Ø³ÙˆØ¯Ø§Ù†</footer>
    </div>
    <div id="toast" class="toast" role="alert" aria-live="assertive"></div>

    <script>
    document.addEventListener('DOMContentLoaded', function () {
        const allScreens = document.querySelectorAll('.screen');
        const navButtons = document.querySelectorAll('button[data-target], a[data-target]');
        const toast = document.getElementById('toast');
        const state = { currentFlow: 'new', preferences: [], maxPreferences: 45 };

        function navigateTo(screenId) {
            allScreens.forEach(s => s.classList.remove('active'));
            const targetScreen = document.getElementById(screenId);
            if (targetScreen) {
                targetScreen.classList.add('active');
                if (screenId === 'preferences-screen') {
                    checkForSavedPreferences();
                }
            }
            updateProgress(screenId);
        }

        navButtons.forEach(button => {
            button.addEventListener('click', (e) => {
                if (button.getAttribute('target') === '_blank') return;
                e.preventDefault();
                const targetId = button.dataset.target;
                if (button.dataset.flow) state.currentFlow = button.dataset.flow;
                if (targetId === 'review-screen') populateReviewScreen();
                navigateTo(targetId);
            });
        });

        function toggleLoading(button, isLoading) {
            const text = button.querySelector('.btn-text');
            if (isLoading) {
                button.disabled = true;
                button.classList.add('loading');
                if (!button.querySelector('.spinner')) {
                    const spinner = document.createElement('div');
                    spinner.className = 'spinner';
                    button.appendChild(spinner);
                }
                if (text) text.style.visibility = 'hidden';
            } else {
                button.disabled = false;
                button.classList.remove('loading');
                const spinner = button.querySelector('.spinner');
                if (spinner) spinner.remove();
                if (text) text.style.visibility = 'visible';
            }
        }

        function validateInput(input, condition) {
            const formGroup = input.parentElement;
            if (condition) {
                formGroup.classList.remove('invalid');
                return true;
            } else {
                formGroup.classList.add('invalid');
                return false;
            }
        }

        const seatNumberInput = document.getElementById('seat-number');
        seatNumberInput.addEventListener('input', () => validateInput(seatNumberInput, seatNumberInput.value.length === 7));

        const loginSeatNumber = document.getElementById('login-seat-number');
        const formNumber = document.getElementById('form-number');
        loginSeatNumber.addEventListener('input', () => validateInput(loginSeatNumber, loginSeatNumber.value.length > 0));
        formNumber.addEventListener('input', () => validateInput(formNumber, formNumber.value.length > 0));

        document.getElementById('generate-invoice-btn').addEventListener('click', (e) => {
            const btn = e.currentTarget;
            if (!validateInput(seatNumberInput, seatNumberInput.value.length === 7)) {
                showToast('Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØµØ­ÙŠØ­ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø©.');
                return;
            }
            toggleLoading(btn, true);
            setTimeout(() => {
                toggleLoading(btn, false);
                const invoiceNum = Math.floor(10000000 + Math.random() * 90000000);
                document.getElementById('invoice-number-text').textContent = invoiceNum;
                document.getElementById('final-form-number').textContent = `ADM-2025-${invoiceNum.toString().slice(0, 6)}`;
                document.getElementById('invoice-result').style.display = 'flex';
                document.getElementById('generate-invoice-btn').style.display = 'none';
            }, 1500);
        });

        document.getElementById('login-btn').addEventListener('click', (e) => {
            const btn = e.currentTarget;
            const isSeatValid = validateInput(loginSeatNumber, loginSeatNumber.value.length > 0);
            const isFormValid = validateInput(formNumber, formNumber.value.length > 0);
            if (!isSeatValid || !isFormValid) return;

            toggleLoading(btn, true);
            setTimeout(() => {
                toggleLoading(btn, false);
                if (state.currentFlow === 'resume') {
                    renderApplicationStatus(loginSeatNumber.value);
                    navigateTo('status-screen');
                } else {
                    navigateTo('preferences-screen');
                }
            }, 1500);
        });

        function renderApplicationStatus(seatNum) {
            const container = document.getElementById('status-card-container');
            const lastDigit = parseInt(seatNum.slice(-1));
            let statusCardHTML = '';
            if (lastDigit <= 3) { statusCardHTML = `<div class="status-card status-card-accepted"><div class="icon">ğŸ‰</div><h2>ØªÙ‡Ø§Ù†ÙŠÙ†Ø§ØŒ ØªÙ… Ù‚Ø¨ÙˆÙ„Ùƒ!</h2><p>ØªÙ… ØªØ±Ø´ÙŠØ­Ùƒ Ù„Ù„Ù‚Ø¨ÙˆÙ„ Ø­Ø³Ø¨ Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØªØ§Ù„ÙŠØ©:</p><div class="acceptance-details"><p><strong>Ø§Ù„Ø¬Ø§Ù…Ø¹Ø©:</strong> Ø¬Ø§Ù…Ø¹Ø© Ø§Ù„Ø®Ø±Ø·ÙˆÙ…</p><p><strong>Ø§Ù„ÙƒÙ„ÙŠØ©:</strong> ÙƒÙ„ÙŠØ© Ø§Ù„Ù‡Ù†Ø¯Ø³Ø© - Ù‚Ø³Ù… Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¡</p></div><br><button class="btn btn-success" onclick="window.print()"><span class="btn-text">Ø·Ø¨Ø§Ø¹Ø© Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ù‚Ø¨ÙˆÙ„</span></button></div>`; } 
            else if (lastDigit <= 6) { statusCardHTML = `<div class="status-card status-card-processing"><div class="icon">â³</div><h2>Ø·Ù„Ø¨Ùƒ Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©</h2><p>Ù„Ø§ ÙŠØ²Ø§Ù„ Ø·Ù„Ø¨Ùƒ Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ ÙÙŠ ÙˆÙ‚Øª Ù„Ø§Ø­Ù‚.</p></div>`; } 
            else { statusCardHTML = `<div class="status-card status-card-rejected"><div class="icon">ğŸ˜”</div><h2>Ù„Ù… ÙŠØªÙ… Ù‚Ø¨ÙˆÙ„Ùƒ</h2><p>Ù†Ø£Ø³Ù Ù„Ø¥Ø¹Ù„Ø§Ù…Ùƒ Ø¨Ø£Ù†Ù‡ Ù„Ù… ÙŠØªÙ… ØªØ±Ø´ÙŠØ­Ùƒ Ù„Ù„Ù‚Ø¨ÙˆÙ„ ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø±Ø­Ù„Ø©.</p><button class="btn btn-secondary"><span class="btn-text">Ø§Ù„Ø§Ø·Ù„Ø§Ø¹ Ø¹Ù„Ù‰ ÙØ±Øµ Ø§Ù„ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ø£Ø®Ø±Ù‰</span></button></div>`; }
            container.innerHTML = statusCardHTML;
        }

        function updateProgress(screenId) {
            const screenStepMap = { 'home-screen': 0, 'invoice-screen': 1, 'login-screen': 2, 'preferences-screen': 3, 'review-screen': 4, 'success-screen': 5 };
            const currentStep = screenStepMap[screenId] || 0;
            const progressContainer = document.getElementById('progress-container');
            progressContainer.style.display = (currentStep > 0 && state.currentFlow === 'new') ? 'block' : 'none';
            if (state.currentFlow !== 'new') return;
            document.querySelectorAll('.step').forEach(step => step.classList.toggle('active', parseInt(step.dataset.step) <= currentStep));
            document.getElementById('progress-line').style.width = `${Math.max(0, (currentStep - 1) / 4 * 100)}%`;
        }

        function showToast(message) {
            toast.textContent = message; toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 3000);
        }

        document.getElementById('copy-invoice-btn').addEventListener('click', () => {
            navigator.clipboard.writeText(document.getElementById('invoice-number-text').textContent)
                .then(() => showToast('ØªÙ… Ù†Ø³Ø® Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø¨Ù†Ø¬Ø§Ø­!'))
                .catch(() => showToast('ÙØ´Ù„ Ø§Ù„Ù†Ø³Ø®.'));
        });

        const preferencesList = document.getElementById('preferences-list');
        
        function renderPreferences() {
            const header = document.querySelector('#preferences-screen h3');
            header.textContent = `Ø§Ù„Ø®Ø·ÙˆØ© 3: Ø§Ø®ØªÙŠØ§Ø± ÙˆØªØ±ØªÙŠØ¨ Ø§Ù„Ø±ØºØ¨Ø§Øª (${state.preferences.length}/${state.maxPreferences})`;
            const isMax = state.preferences.length >= state.maxPreferences;
            document.getElementById('add-preference-btn').disabled = isMax;
            document.getElementById('add-preference-card').style.display = isMax ? 'none' : 'block';
            
            preferencesList.innerHTML = '';
            state.preferences.forEach((pref, index) => {
                const item = document.createElement('div');
                item.className = 'preference-item';
                item.setAttribute('draggable', 'true');
                item.dataset.index = index;
                item.innerHTML = `<span class="drag-handle" aria-label="Ø§Ø³Ø­Ø¨ Ù„Ù„ØªØ±ØªÙŠØ¨">â˜°</span><span class="num">${index + 1}.</span><div class="text"><strong>${pref.university}</strong><br><small>${pref.faculty}</small></div><button class="delete-btn" data-index="${index}" aria-label="Ø­Ø°Ù Ø§Ù„Ø±ØºØ¨Ø© ${index + 1}">âœ•</button>`;
                preferencesList.appendChild(item);
            });
            savePreferencesToLocalStorage();
        }

        function savePreferencesToLocalStorage() {
            localStorage.setItem('savedPreferences', JSON.stringify(state.preferences));
        }

        function checkForSavedPreferences() {
            const savedJSON = localStorage.getItem('savedPreferences');
            if (savedJSON) {
                const savedPreferences = JSON.parse(savedJSON);
                if (savedPreferences.length > 0) {
                    if (confirm('ÙˆØ¬Ø¯Ù†Ø§ Ø±ØºØ¨Ø§Øª Ù…Ø­ÙÙˆØ¸Ø© Ù…Ù† Ø¬Ù„Ø³Ø© Ø³Ø§Ø¨Ù‚Ø©. Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ø³ØªØ¹Ø§Ø¯ØªÙ‡Ø§ØŸ')) {
                        state.preferences = savedPreferences;
                        renderPreferences();
                        showToast('ØªÙ… Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø±ØºØ¨Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© Ø¨Ù†Ø¬Ø§Ø­.');
                    } else {
                        localStorage.removeItem('savedPreferences');
                    }
                }
            }
        }

        document.getElementById('add-preference-btn').addEventListener('click', () => {
            const uni = document.getElementById('university'), fac = document.getElementById('faculty');
            if (uni.selectedIndex === 0 || fac.selectedIndex === 0) { return showToast('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¬Ø§Ù…Ø¹Ø© ÙˆØ§Ù„ÙƒÙ„ÙŠØ©.'); }
            state.preferences.push({ university: uni.options[uni.selectedIndex].text, faculty: fac.options[fac.selectedIndex].text });
            renderPreferences();
            uni.selectedIndex = 0; fac.selectedIndex = 0;
        });

        preferencesList.addEventListener('click', (e) => {
            if (e.target.classList.contains('delete-btn')) {
                const indexToDelete = parseInt(e.target.dataset.index);
                state.preferences.splice(indexToDelete, 1);
                renderPreferences();
            }
        });

        // Drag and Drop Logic
        let draggedItem = null;
        preferencesList.addEventListener('dragstart', e => {
            draggedItem = e.target.closest('.preference-item');
            if (draggedItem) {
                draggedItem.dataset.originalIndex = draggedItem.dataset.index; // Store current index
                setTimeout(() => draggedItem.classList.add('dragging'), 0);
            }
        });

        preferencesList.addEventListener('dragend', () => {
            if (draggedItem) {
                draggedItem.classList.remove('dragging');
                draggedItem = null;
            }
        });

        preferencesList.addEventListener('dragover', e => {
            e.preventDefault();
            const afterElement = getDragAfterElement(preferencesList, e.clientY);
            const currentDragged = document.querySelector('.dragging');
            if (currentDragged) {
                if (afterElement == null) {
                    preferencesList.appendChild(currentDragged);
                } else {
                    preferencesList.insertBefore(currentDragged, afterElement);
                }
            }
        });

        preferencesList.addEventListener('drop', () => {
            const newOrder = Array.from(preferencesList.querySelectorAll('.preference-item')).map(item => {
                // Find the preference object using the original index stored in the dataset
                return state.preferences[parseInt(item.dataset.originalIndex)];
            });
            state.preferences = newOrder;
            renderPreferences(); // Re-render to fix indices and numbers
        });

        function getDragAfterElement(container, y) {
            const draggableElements = [...container.querySelectorAll('.preference-item:not(.dragging)')];
            return draggableElements.reduce((closest, child) => {
                const box = child.getBoundingClientRect();
                const offset = y - box.top - box.height / 2;
                if (offset < 0 && offset > closest.offset) {
                    return { offset: offset, element: child };
                } else {
                    return closest;
                }
            }, { offset: Number.NEGATIVE_INFINITY }).element;
        }

        function populateReviewScreen() {
            document.getElementById('review-seat-number').textContent = document.getElementById('login-seat-number').value || 'ØºÙŠØ± Ù…Ø¯Ø®Ù„';
            const admissionTypeSelect = document.getElementById('admission-type');
            document.getElementById('review-admission-type').textContent = admissionTypeSelect.options[admissionTypeSelect.selectedIndex].text;
            const reviewList = document.getElementById('review-preferences-list');
            reviewList.innerHTML = state.preferences.length === 0 ? '<li>Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø£ÙŠ Ø±ØºØ¨Ø§Øª.</li>' : state.preferences.map(p => `<li>${p.university} - ${p.faculty}</li>`).join('');
        }

        document.getElementById('confirmation-check').addEventListener('change', (e) => {
            document.getElementById('confirm-submission-btn').disabled = !e.target.checked;
        });
        
        document.getElementById('print-form-btn').addEventListener('click', () => { window.print(); });

        document.querySelectorAll('button[data-target="home-screen"]').forEach(btn => btn.addEventListener('click', () => {
            Object.assign(state, { currentFlow: 'new', preferences: [] });
            localStorage.removeItem('savedPreferences');
            renderPreferences();
            ['invoice-form', 'login-form'].forEach(id => document.getElementById(id).reset());
            document.getElementById('confirmation-check').checked = false;
            document.getElementById('confirm-submission-btn').disabled = true;
            document.getElementById('invoice-result').style.display = 'none';
            document.getElementById('generate-invoice-btn').style.display = 'block';
        }));

        navigateTo('home-screen');
    });
    </script>
</body>
</html>
